ИТМО Университет  
Факультет программной инженерии и компьютерной техники  
Дисциплина: Коммуникационные сервисы  

Лабораторная работа №2  
**Тема:** Логирование, мониторинг и визуализация на примере Nextcloud, Loki, Zabbix и Grafana  

Студенты:  
Группаы:  
Преподаватель: 

Санкт-Петербург, 2025 г.

---

## Цель работы

Изучить основы построения системы логирования, мониторинга и визуализации состояния сервиса на примере стека:
- Nextcloud как тестовое web‑приложение;
- Loki + Promtail для сбора и хранения логов;
- Zabbix для мониторинга доступности сервиса;
- Grafana для визуализации логов и метрик.

---

## Используемое ПО

- Docker, Docker Compose  
- Nextcloud (`nextcloud:29.0.6`)  
- Grafana Loki (`grafana/loki:2.9.0`)  
- Grafana (`grafana/grafana:11.2.0`)  
- Promtail (`grafana/promtail:2.9.0`)  
- PostgreSQL 15 (для Zabbix)  
- Zabbix Server + Zabbix Web (`zabbix/zabbix-server-pgsql:ubuntu-6.4-latest`, `zabbix/zabbix-web-nginx-pgsql:ubuntu-6.4-latest`)

---

## Ход работы

### Часть 1. Подготовка окружения и запуск docker-compose

1. Подключение по SSH к удалённой машине.

![SSH‑подключение](screenshots/01_ssh_connection.png)

2. Передача файлов (в том числе `docker-compose.yml`) на удалённый сервер.

![Передача файлов](screenshots/02_file_transfer.png)

3. Запуск docker-compose для развёртывания стенда.

![Запуск docker-compose](screenshots/03_docker_compose_up.png)

4. Проверка запущенных контейнеров.

![Список контейнеров](screenshots/04_docker_compose_ps.png)

5. Настройка брандмауэра / прокидывание нужных портов.

![Открытые порты](screenshots/05_firewall_ports.png)

---

### Часть 2. Инициализация Nextcloud и проверка работы

1. Открытие мастера установки Nextcloud по адресу `http://<host>:8080` и задание параметров админ‑аккаунта.

![Мастер установки Nextcloud](screenshots/06_nextcloud_setup.png)

2. Создание учётной записи администратора.

![Создание учётной записи](screenshots/07_nextcloud_account.png)

3. Открытие главной страницы Nextcloud, проверка работоспособности сервиса.

![Главная страница Nextcloud](screenshots/08_nextcloud_home.png)

4. Дополнительные действия в интерфейсе (загрузка/удаление файлов и т.д.), формирующие логи.

![Работа с файлами в Nextcloud](screenshots/11222.png)

---

### Часть 3. Логирование: Loki и Promtail

Для сбора логов Nextcloud был настроен агент Promtail, который читает лог‑файлы из тома с данными Nextcloud и отправляет их в Loki.  
Настройки описаны в файле `promtail_config.yml` (каталог `lab2_work`).

1. Проверка того, что Loki успешно принимает данные (статус сервиса / healthcheck).

![Успешная проверка Loki](screenshots/loki succseseccc.png)

2. Просмотр логов Nextcloud через интерфейс Grafana по источнику данных Loki.

![Просмотр логов в Grafana](screenshots/27_grafana_new_dashboard.png)

---

### Часть 4. Мониторинг в Zabbix

Для мониторинга доступности Nextcloud был подготовлен шаблон Zabbix (`template.yml`), использующий HTTP‑агента для обращения к `status.php` приложения и определения режима обслуживания (maintenance).

1. Вход в веб‑интерфейс Zabbix.

![Вход в Zabbix](screenshots/10_zabbix_login.png)

2. Переход в раздел шаблонов и подготовка к импорту.

![Навигация к шаблонам](screenshots/11_zabbix_navigation_templates.png)

3. Импорт подготовленного шаблона мониторинга Nextcloud из файла `template.yml`.

![Импорт шаблона](screenshots/12_zabbix_template_import.png)

4. Переход в раздел хостов и создание нового хоста для Nextcloud.

![Навигация к хостам](screenshots/14_zabbix_navigation_hosts.png)

5. Заполнение параметров нового хоста и привязка к нему ранее импортированного шаблона.

![Создание хоста](screenshots/15_zabbix_host_create.png)

6. Проверка, что хост успешно создан и активен.

![Хост сконфигурирован](screenshots/16_zabbix_host_configured.png)

7. Просмотр собираемых данных по хосту в разделе Latest data.

![Последние данные по хосту](screenshots/17_zabbix_navigation_latest_data.png)

8. Наблюдение за метриками и состоянием Nextcloud по данным Zabbix.

![Мониторинг в Zabbix](screenshots/18_zabbix_monitoring_data.png)

9. Убедились, что триггеры по шаблону корректно срабатывают (например, при включении режима обслуживания).

![Успешная работа Zabbix](screenshots/zabbix sucess.png)

---

### Часть 5. Визуализация в Grafana

1. Подключение к веб‑интерфейсу Grafana.

![Интерфейс Grafana](screenshots/Screenshot 2025-12-13 192334.png)

2. Настройка источника данных Loki и (при необходимости) источника Zabbix через установленный плагин.

![Настройка панелей Grafana](screenshots/27_grafana_new_dashboard.png)

3. Создание дашбордов для:
   - отображения логов Nextcloud (источник Loki);
   - отображения метрик доступности и состояния сервиса (источник Zabbix);
   - комбинированных панелей.

Примеры экранов с готовыми панелями приведены ниже.

![Пример графиков и панелей](screenshots/werqawerfadfaszd.png)
![Ещё один пример дашборда](screenshots/123333.png)

---

## Ответы на контрольные вопросы

**1. Чем SLO отличается от SLA?**

- **SLA (Service Level Agreement)** – юридическое соглашение между поставщиком услуг и клиентом, определяющее условия предоставления услуги (например, минимальную доступность 99,9 %). При нарушении SLA возможны штрафы и другие санкции.  
- **SLO (Service Level Objective)** – внутренние целевые значения метрик для команды эксплуатации/разработки (например, целевая доступность 99,95 %). Это цель, но не обязательно формальное юридическое обязательство.

---

**2. Чем отличается инкрементальный бэкап от дифференциального?**

- **Дифференциальный бэкап** – копируются все данные, изменённые с момента последнего полного бэкапа. Для восстановления нужны последний полный бэкап и последний дифференциальный.  
- **Инкрементальный бэкап** – копируются данные, изменённые с момента любого последнего бэкапа (полного или инкрементального). Для восстановления нужны последний полный бэкап и вся цепочка инкрементальных бэкапов. Инкрементальные копии обычно меньше по размеру, но восстановление сложнее и дольше.

---

**3. В чём разница между мониторингом и observability?**

- **Мониторинг** – реактивный подход: наблюдение за заранее определёнными метриками и состояниями (CPU, RAM, ошибки, аптайм). Отвечает на вопрос «не вышло ли что‑то за порог?».  
- **Observability (наблюдаемость)** – проактивный подход: способность по логам, метрикам и трассировкам понять внутреннее состояние сложной системы и причину проблемы, даже если она заранее не была описана. Отвечает на вопрос «почему система ведёт себя именно так?».

---

## Вывод

В ходе лабораторной работы был развёрнут комплекс сервисов для логирования, мониторинга и визуализации состояния веб‑приложения Nextcloud с использованием Docker Compose.  
Promtail настроен на чтение лог‑файлов Nextcloud и отправку их в Loki, что позволило анализировать логи через Grafana.  
Система мониторинга Zabbix настроена для проверки состояния Nextcloud через HTTP‑запрос к `status.php` и реагирования на режим обслуживания с помощью триггера.  
В Grafana созданы дашборды, объединяющие логи и метрики, что обеспечивает наглядное представление о состоянии сервиса и позволяет оперативно выявлять и анализировать инциденты.


